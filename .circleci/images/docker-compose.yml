version: '3'
# Note: This file is used to build run the integration tests.
#   for running network tests it maps sources and docker unix port inside the container
#   to build use:
#   BROWSER=chrome BVER=stable docker-compose --file=./docker-compose.yml build integrationTestContainer
#   to run use:
#   BROWSER=chrome BVER=stable docker-compose --file=./docker-compose.yml run integrationTestContainer
services:
  integrationTestContainer:
    environment:
    - ENVIRONMENT=${ENVIRONMENT}
    - ACCOUNT_SID=${ACCOUNT_SID}
    - API_KEY_SID=${API_KEY_SID}
    - API_KEY_SECRET=${API_KEY_SECRET}
    - TOPOLOGY=${TOPOLOGY}
    - BVER=${BVER}
    user: root
    image: makarandp/twilio-video:${BROWSER}-${BVER}
    command: bash -c "npm install && npm run test:integration"
    build:
      context: .
      dockerfile: ./${BROWSER}/${BVER}/Dockerfile
    working_dir: /opt/app
    container_name: "twilio-video-${BROWSER}-${BVER}"
    volumes:
      - "../../:/opt/app"
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/app/node_modules
